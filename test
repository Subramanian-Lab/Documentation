**Guide to Using PBS and HPC for Your Work**

This guide is designed to help you get started with using PBS (Portable Batch System) and an HPC (High-Performance Computing) system effectively. Whether you’re just starting out or need a reference for advanced topics, this document serves as a comprehensive resource to guide you through every step of the process.

---

## **Table of Contents**

1. **Introduction to HPC and PBS**
2. **How PBS and HPC Work**
3. **Basic Concepts and Terminology**
4. **Preparing Your Environment**
5. **Writing and Submitting PBS Jobs**
6. **Monitoring and Managing Jobs**
7. **Debugging Common Issues**
8. **Tips and Best Practices**
9. **References and Further Reading**
10. **PBS Commands Cheat Sheet**

---

## **1. Introduction to HPC and PBS**

High-Performance Computing (HPC) refers to the use of supercomputers and clusters of servers to perform computations much faster than a typical workstation. These systems are essential for handling large-scale data analysis, simulations, and other compute-intensive tasks that would take weeks or months on a personal computer.

Portable Batch System (PBS) is a workload management system that simplifies the process of submitting, scheduling, and monitoring jobs on an HPC cluster. By using PBS, users can efficiently allocate resources, queue jobs, and ensure that tasks are executed in an organized manner without manual intervention. This makes it an indispensable tool for anyone working in a computationally demanding field.

---

## **2. How PBS and HPC Work**

The basic structure of an HPC system consists of several interconnected components. First, there is the head node, which serves as the central hub. This is where users log in to prepare scripts, manage files, and submit jobs. Then there are the compute nodes, which are the actual machines where your computations take place. The entire system is connected by a shared filesystem, allowing seamless access to your data across all nodes.

PBS operates as an intermediary between users and the HPC system. When you submit a job using PBS, it is added to a queue and scheduled based on resource availability and priority. PBS ensures that the compute nodes are used efficiently, distributing workloads evenly and preventing resource conflicts. Once a node becomes available, PBS assigns the job and monitors its progress until completion.

---

## **3. Basic Concepts and Terminology**

Before diving into the technical details, it’s important to understand some key terms. A "job" refers to a script or command submitted to PBS for execution. Jobs are placed in a "queue," which is a list of tasks waiting to run. Each "node" represents an individual server within the HPC cluster, and "walltime" is the maximum duration a job is allowed to run.

Resources such as CPU cores, memory, and storage are critical to job execution, and they must be specified accurately in your PBS scripts. CPU cores (or processors) are the units within a computer that execute instructions. The more cores you allocate to a job, the more parallel tasks it can handle, significantly speeding up computation for multi-threaded programs. Memory, or RAM, is the space available for your job’s data and processes while they are running. Insufficient memory can cause a job to crash, so it’s important to request enough for your workload. Storage refers to the disk space available for storing input files, temporary data, and outputs generated by your job. Understanding these resources ensures efficient usage and successful job execution in the HPC environment.

Some commonly used commands include `qsub` for submitting jobs, `qstat` for checking the status of jobs, `qdel` for canceling jobs, and `pbsnodes` for viewing information about the nodes in the cluster. Familiarity with these commands will greatly enhance your ability to work effectively with PBS.

---

## **4. Preparing Your Environment**

To get started, you need to log in to the HPC system using Secure Shell (SSH). This involves connecting to the head node using your institutional credentials. For example:

```bash
ssh your_username@hpc.yourinstitution.edu
```

Once logged in, navigate to your home directory or project folder, where you will prepare your scripts and files.

Modules are used to configure your environment on the HPC system. These modules load the software and libraries needed for your computations. To load a module, use the `module load` command followed by the module name. To see a list of available modules, you can run `module avail`. Make sure to load all necessary modules explicitly in your PBS script to avoid runtime errors.

---

## **5. Writing and Submitting PBS Jobs**

A PBS job script is essentially a Bash script with special directives that specify the resources your job requires. These directives start with `#PBS` and are followed by options such as job name, number of nodes, walltime, memory, and output file paths.

For example, here is a basic PBS script:

```bash
#!/bin/bash
#PBS -N my_job_name
#PBS -l nodes=1:ppn=4
#PBS -l walltime=02:00:00
#PBS -l mem=8gb
#PBS -q batch
#PBS -o output.log
#PBS -e error.log

# Load required modules
module load python/3.8

# Change to the directory where the job was submitted from
cd $PBS_O_WORKDIR

# Run your command
python my_script.py
```

This script specifies a job named "my_job_name" that will use one node with four processor cores, 8GB of memory, and a maximum runtime of two hours. The outputs and errors will be written to `output.log` and `error.log` respectively.

To submit the script, use the `qsub` command:

```bash
qsub my_pbs_script.pbs
```

After submission, PBS will assign your job a unique ID, which you can use to track its status.

---

## **6. Monitoring and Managing Jobs**

Once your job is in the queue, you can monitor its progress using the `qstat` command. Running `qstat` without arguments will show all your jobs and their statuses. For more detailed information about a specific job, use:

```bash
qstat -f <job_id>
```

You can also view the status of compute nodes using the `pbsnodes` command. If you need to cancel a job, use the `qdel` command followed by the job ID:

```bash
qdel <job_id>
```

---

## **7. Debugging Common Issues**

It’s not uncommon to encounter issues when working with PBS. If your job doesn’t start, check whether the queue is full or if you’ve requested excessive resources. When a job crashes, review the error log for details on what went wrong. Errors are often related to incorrect module loading, missing files, or bugs in your script.

If you’re stuck, consult the system administrator or refer to the HPC user guide provided by your institution.

---

## **8. Tips and Best Practices**

When working with PBS and HPC, always start with a small test job to ensure your script works as expected. Optimize your resource requests to avoid unnecessary delays in the queue. Organize your output and error files with clear, descriptive names. Document your processes and scripts meticulously for future reference. Finally, take advantage of modules to load the exact environment your job requires.

---

## **9. References and Further Reading**

For additional guidance, consult the official PBS Pro documentation or your institution’s HPC user guide. Online resources such as Linux command cheat sheets can also be valuable for improving your command-line skills. Keep learning and experimenting to make the most of your HPC system.

---

## **10. PBS Commands Cheat Sheet**

Here’s a quick reference guide to commonly used PBS commands:

### **Job Submission**
- `qsub <script_name>`: Submits a job to the queue.

### **Job Monitoring**
- `qstat`: Lists all your jobs and their current status.
- `qstat -f <job_id>`: Provides detailed information about a specific job.
- `qstat -u <username>`: Displays jobs submitted by a specific user.

### **Job Management**
- `qdel <job_id>`: Cancels a job in the queue.
- `qhold <job_id>`: Places a hold on a job, preventing it from running.
- `qrls <job_id>`: Releases a previously held job.

### **Node Information**
- `pbsnodes`: Displays information about all compute nodes.
- `pbsnodes -a`: Provides detailed information about all nodes.
- `pbsnodes <node_name>`: Displays information for a specific node.

### **Queue Management**
- `qstat -q`: Lists all available queues.
- `qstat -Q`: Displays information about each queue’s usage.

### **Resource Allocation**
- `qstat -r`: Shows running jobs with detailed resource allocation.

### **General Commands**
- `tracejob <job_id>`: Traces the history of a job (useful for debugging).
- `qalter`: Modifies the attributes of a submitted job.

These commands, combined with the detailed sections above, should cover most scenarios you encounter while using PBS and HPC. Use this cheat sheet as a quick reminder for syntax and options while working on the cluster.

---

Feel free to reach out with any questions or suggestions to improve this guide!


